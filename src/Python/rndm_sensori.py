import mysql.connector
import pycristoforo as pyc
import folium as f
from shapely import geometry

place = geometry.Polygon([[10.990064823692949,42.718369991279275],[10.991197901746812,42.716763493360155],[10.999309475724042,42.71993197386976],[10.997483344899445,42.72241078484052],[10.997003629390608,42.72273779720201],[10.992274561305399,42.725321970448256],[10.988590738186609,42.72721591138137],[10.987268412473362,42.72794743046982],[10.985645646864715,42.72858435591943],[10.9825394971954,42.72979509777401],[10.978901189868946,42.73120718042289],[10.975403589313526,42.73249173982014],[10.97118808449399,42.73413265835293],[10.967669207069024,42.73548635168816],[10.96390525963649,42.731090985169715],[10.97157680532987,42.72555967532561],[10.97561263007067,42.728644431249705],[10.977279299354974,42.72759111095012],[10.97821379481215,42.727220689986744],[10.978846796139665,42.72707882605332],[10.979088193509439,42.726784975928055],[10.980017856048509,42.7259210676871],[10.98061581040306,42.72533510969274],[10.981822589783725,42.72419418597686],[10.9830073937009,42.722940773798534],[10.983983414552,42.72244487371097],[10.984922221385434,42.72171084632538],[10.985553136549825,42.72132751087736],[10.986355706419747,42.72113334048012],[10.987422601863019,42.72074143418754],[10.988055603190533,42.72051285159675],[10.990064823692949,42.718369991279275]])
n_nodes = 1000
points = pyc.geoloc_generation(place, n_nodes, "Italy")
map = f.Map(location=[42.730058,10.974754], tiles="OpenStreetMap", zoom_start=15)

mydb = mysql.connector.connect(
  host="localhost",
  user="root",
  password="",
  database="fire_prevention_system"
)
mycursor = mydb.cursor()
sql = "INSERT INTO sensori (arduinoId, lat, lng, data_inst) VALUES (%s, %s, %s, %s)"
start_id = 3828095009354745390
for x in points:
    f.Marker(
        location=[x["geometry"]["coordinates"][1],x["geometry"]["coordinates"][0]],
    ).add_to(map)
    start_id += 1
    val = (start_id,x["geometry"]["coordinates"][0], x["geometry"]["coordinates"][1], '2021-05-12')
    mycursor.execute(sql, val)
    mydb.commit()


map.save('map.html')