DROP DATABASE IF EXISTS fire_prevention_system;
CREATE DATABASE fire_prevention_system;
USE fire_prevention_system;

/*STRUCTURE*/

CREATE TABLE sensori (
  arduinoId bigint NOT NULL PRIMARY KEY,
  lat double DEFAULT NULL,
  lng double DEFAULT NULL,
  data_inst date DEFAULT NULL,
  data_rim date DEFAULT NULL
);

CREATE TABLE misurazioni (
  dataId bigint UNSIGNED NOT NULL PRIMARY KEY AUTO_INCREMENT,
  sensore bigint NOT NULL,
  temperatura tinyint NOT NULL,
  umidita tinyint UNSIGNED NOT NULL,
  co2 smallint UNSIGNED NOT NULL,
  tvoc smallint UNSIGNED NOT NULL,
  updateId smallint UNSIGNED NOT NULL,
  timestamp timestamp NOT NULL DEFAULT current_timestamp(),
  fire_index tinyint UNSIGNED NOT NULL DEFAULT 0,
  FOREIGN KEY (sensore) REFERENCES sensori(arduinoId),
  INDEX(sensore),
  INDEX(updateId),
  INDEX(timestamp)
);

CREATE TABLE snapshot (
timestamp timestamp NOT NULL PRIMARY KEY DEFAULT current_timestamp(),
titolo varchar(50) DEFAULT NULL,
descrizione varchar(200) DEFAULT NULL
);

CREATE TABLE snapshot_misurazioni (
snapshot timestamp NOT NULL,
misurazione bigint UNSIGNED NOT NULL,
PRIMARY KEY(snapshot, misurazione),
FOREIGN KEY (snapshot) references snapshot(timestamp),
FOREIGN KEY (misurazione) references misurazioni(dataId)
);

CREATE TABLE utenti (
  utenteId int UNSIGNED NOT NULL PRIMARY KEY AUTO_INCREMENT,
  cf char(16) NOT NULL UNIQUE,
  nome varchar(20) NOT NULL,
  cognome varchar(20) NOT NULL,
  telefono char(10) NOT NULL UNIQUE,
  email varchar(50) NOT NULL UNIQUE,
  pw char(64) NOT NULL,
  ruolo set('tecnico','amministratore','supervisore') DEFAULT NULL,
  amministratore int UNSIGNED DEFAULT NULL,
  FOREIGN KEY (amministratore) references utenti(utenteId)
);

CREATE TABLE richieste (
  richiestaId int UNSIGNED NOT NULL PRIMARY KEY AUTO_INCREMENT,
  timestamp timestamp NOT NULL,
  motivazione varchar(500) NOT NULL,
  urgenza set('1', '2', '3') NOT NULL DEFAULT '3',
  sensore bigint NOT NULL,
  supervisore int UNSIGNED NOT NULL,
  FOREIGN KEY (supervisore) references utenti(utenteId),
  FOREIGN KEY (sensore) references sensori(arduinoId)
);

CREATE TABLE interventi (
  interventoId int UNSIGNED NOT NULL PRIMARY KEY AUTO_INCREMENT,
  timestamp timestamp NOT NULL,
  descrizione varchar(500) NOT NULL,
  risolutivo bool NOT NULL DEFAULT FALSE,
  tecnico int UNSIGNED NOT NULL,
  FOREIGN KEY (tecnico) references utenti(utenteId)
);

CREATE TABLE richieste_interventi (
  richiesta int UNSIGNED NOT NULL,
  intervento int UNSIGNED NOT NULL,
  PRIMARY KEY (richiesta, intervento),
  FOREIGN KEY (richiesta) references richieste(richiestaId),
  FOREIGN KEY (intervento) references interventi(interventoId)
);

CREATE TABLE opzioni (
  chiave varchar(30) NOT NULL PRIMARY KEY,
  valore varchar(500) NOT NULL,
  descrizione varchar(200) NOT NULL
);

/*TRIGGERS*/
DELIMITER $$
CREATE TRIGGER update_fire_index
BEFORE INSERT ON misurazioni
FOR EACH ROW
BEGIN
SET @fi = 0;
IF new.temperatura < 40 THEN 
  IF new.umidita > 40 THEN
    SET @fi = 0;
  ELSE
    SET @fi = 1;
  END IF;
ELSE
  IF new.temperatura < 60 THEN
    IF new.co2 < 5000 THEN
      SET @fi = 2;
    ELSE
      IF new.co2 < 10000 THEN
        SET @fi = 3;
      ELSE
        SET @fi = 4;
      END IF;
    END IF;
  ELSE
    IF new.temperatura < 80 THEN
      IF new.co2 < 25000 THEN
        SET @fi = 4;
      ELSE
        SET @fi = 5;
      END IF;
    ELSE
      SET @fi = 5;
    END IF;
  END IF;
END IF;
SET new.fire_index = @fi;
END$$
DELIMITER ;

/*PROCEDURES*/
DELIMITER $$
CREATE DEFINER=root@localhost PROCEDURE add_to_snapshot(IN par1 TIMESTAMP)
    MODIFIES SQL DATA
BEGIN
DECLARE bDone INT;
DECLARE sen BIGINT;
DECLARE curs CURSOR FOR SELECT arduinoId FROM sensori;
DECLARE CONTINUE HANDLER FOR NOT FOUND SET bDone = 1;
SET @snap = par1;
OPEN curs;
SET bDone = 0;
WHILE NOT bDone DO
	FETCH curs INTO sen;
    IF NOT bDone THEN
    SELECT max(dataId) into @mis from misurazioni as m where m.sensore = sen;
    INSERT INTO snapshot_misurazioni VALUE (@snap, @mis);
    END IF;
END WHILE;
CLOSE curs;
END$$
DELIMITER ;

DELIMITER $$
CREATE DEFINER=root@localhost PROCEDURE set_snapshot_interval(IN par1 INT)
    MODIFIES SQL DATA
BEGIN
ALTER EVENT auto_snapshot ON SCHEDULE EVERY par1 MINUTE;
UPDATE opzioni SET valore = par1 WHERE chiave = "snapshot_interval";
SET GLOBAL EVENT_SCHEDULER = "ON";
END$$
DELIMITER ;

DELIMITER $$
CREATE DEFINER=root@localhost PROCEDURE take_snapshot(IN par1 TIMESTAMP, IN par2 TEXT, IN par3 TEXT)
    MODIFIES SQL DATA
BEGIN
INSERT INTO snapshot
VALUE(par1, par2, par3);
CALL add_to_snapshot(par1);
END$$
DELIMITER ;

DELIMITER $$
CREATE DEFINER=root@localhost PROCEDURE eval(IN param TEXT)
    MODIFIES SQL DATA
begin 
    set @sql = param; 
    prepare stmt from @sql; 
    execute stmt; 
    deallocate prepare stmt; 
end$$
DELIMITER ;

/*EVENTS*/
DELIMITER $$
CREATE DEFINER=root@localhost EVENT auto_snapshot ON SCHEDULE EVERY 5 MINUTE STARTS '1980-05-10 00:00:00' ON COMPLETION NOT PRESERVE ENABLE DO BEGIN
SET @ts = CURRENT_TIMESTAMP();
CALL take_snapshot(@ts, NULL, NULL);
END$$
DELIMITER ;

/*DATA*/

INSERT INTO sensori VALUES
(CONVERT(0x35202020ff09062d, UNSIGNED), 42.730058, 10.974754, '2021-04-05', NULL),
(CONVERT(0x35202020ff09062e, UNSIGNED), 42.730704, 10.975548, '2021-04-05', NULL);

INSERT INTO misurazioni (sensore, temperatura, umidita, co2, tvoc, updateId, timestamp) VALUES
(CONVERT (0x35202020ff09062d, UNSIGNED), 25, 42, 555, 23, 169, '2021-04-05 15:16:08'),
(CONVERT (0x35202020ff09062e, UNSIGNED), 25, 42, 555, 23, 169, '2021-04-05 15:16:08'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 25, 42, 561, 24, 170, '2021-04-05 15:16:22'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 25, 42, 561, 24, 171, '2021-04-05 15:16:36'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 25, 43, 518, 17, 172, '2021-04-05 15:16:49'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 25, 43, 518, 17, 172, '2021-04-05 15:16:49'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 25, 42, 526, 19, 173, '2021-04-05 15:17:01'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 25, 42, 526, 19, 173, '2021-04-05 15:17:01'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 25, 42, 553, 23, 174, '2021-04-05 15:17:16'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 25, 43, 534, 20, 175, '2021-04-05 15:17:31'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 25, 42, 858, 69, 176, '2021-04-05 15:17:45'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 25, 42, 858, 69, 176, '2021-04-05 15:17:45'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 25, 46, 694, 44, 177, '2021-04-05 15:17:55'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 25, 44, 601, 30, 178, '2021-04-05 15:18:08'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 25, 44, 601, 30, 178, '2021-04-05 15:18:08'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 25, 44, 753, 53, 179, '2021-04-05 15:18:18'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 25, 44, 753, 53, 179, '2021-04-05 15:18:18'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 25, 44, 1331, 141, 180, '2021-04-05 15:18:32'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 25, 43, 736, 51, 181, '2021-04-05 15:18:47'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 25, 43, 766, 55, 182, '2021-04-05 15:19:00'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 25, 44, 714, 47, 183, '2021-04-05 15:19:11'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 25, 44, 624, 34, 184, '2021-04-05 15:19:23'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 25, 43, 819, 63, 185, '2021-04-05 15:19:34'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 25, 43, 819, 63, 185, '2021-04-05 15:19:34'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 25, 43, 735, 51, 186, '2021-04-05 15:19:45'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 25, 42, 561, 24, 187, '2021-04-05 15:19:56'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 25, 41, 551, 23, 188, '2021-04-05 15:20:07'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 25, 41, 419, 2, 189, '2021-04-05 15:20:22'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 25, 40, 400, 0, 190, '2021-04-05 15:20:34'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 25, 39, 400, 0, 191, '2021-04-05 15:20:44'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 25, 38, 400, 0, 192, '2021-04-05 15:20:55'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 25, 38, 400, 0, 193, '2021-04-05 15:21:10'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 25, 37, 400, 0, 194, '2021-04-05 15:21:22'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 25, 37, 400, 0, 194, '2021-04-05 15:21:22'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 25, 37, 400, 0, 195, '2021-04-05 15:21:36'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 25, 37, 400, 0, 196, '2021-04-05 15:21:47'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 25, 37, 400, 0, 196, '2021-04-05 15:21:47'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 25, 36, 400, 0, 197, '2021-04-05 15:21:59'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 25, 36, 400, 0, 198, '2021-04-05 15:22:13'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 25, 36, 400, 0, 199, '2021-04-05 15:22:25'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 25, 36, 471, 10, 200, '2021-04-05 15:22:36'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 25, 36, 470, 10, 201, '2021-04-05 15:22:51'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 25, 36, 477, 11, 202, '2021-04-05 15:23:03'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 25, 36, 400, 0, 203, '2021-04-05 15:23:16'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 25, 36, 406, 0, 204, '2021-04-05 15:23:27'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 25, 36, 414, 2, 205, '2021-04-05 15:23:40'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 25, 36, 414, 2, 206, '2021-04-05 15:23:53'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 25, 36, 400, 0, 207, '2021-04-05 15:24:07'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 25, 36, 403, 0, 208, '2021-04-05 15:24:18'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 25, 36, 405, 0, 209, '2021-04-05 15:24:33'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 25, 36, 470, 10, 210, '2021-04-05 15:24:46'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 25, 36, 476, 11, 211, '2021-04-05 15:25:01'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 25, 36, 507, 16, 212, '2021-04-05 15:25:16'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 25, 37, 457, 8, 213, '2021-04-05 15:25:31'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 37, 488, 13, 214, '2021-04-05 15:25:43'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 37, 637, 36, 215, '2021-04-05 15:25:57'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 37, 620, 33, 216, '2021-04-05 15:26:07'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 37, 620, 33, 217, '2021-04-05 15:26:20'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 37, 588, 28, 218, '2021-04-05 15:26:32'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 37, 588, 28, 219, '2021-04-05 15:26:45'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 36, 503, 15, 220, '2021-04-05 15:27:00'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 36, 466, 10, 221, '2021-04-05 15:27:13'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 36, 436, 5, 222, '2021-04-05 15:27:28'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 36, 436, 5, 222, '2021-04-05 15:27:28'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 36, 442, 6, 223, '2021-04-05 15:27:40'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 36, 442, 6, 223, '2021-04-05 15:27:40'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 36, 427, 4, 224, '2021-04-05 15:27:51'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 36, 413, 1, 225, '2021-04-05 15:28:02'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 36, 427, 4, 226, '2021-04-05 15:28:15'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 36, 436, 5, 227, '2021-04-05 15:28:28'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 36, 436, 5, 228, '2021-04-05 15:28:40'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 36, 441, 6, 229, '2021-04-05 15:28:53'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 36, 425, 3, 230, '2021-04-05 15:29:06'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 36, 425, 3, 230, '2021-04-05 15:29:06'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 36, 448, 7, 231, '2021-04-05 15:29:20'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 36, 434, 5, 232, '2021-04-05 15:29:32'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 36, 434, 5, 233, '2021-04-05 15:29:44'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 36, 434, 5, 233, '2021-04-05 15:29:44'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 36, 414, 2, 234, '2021-04-05 15:29:57'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 36, 441, 6, 235, '2021-04-05 15:30:09'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 36, 406, 0, 236, '2021-04-05 15:30:23'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 36, 410, 1, 238, '2021-04-05 15:30:47'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 36, 410, 1, 238, '2021-04-05 15:30:47'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 36, 441, 6, 239, '2021-04-05 15:30:58'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 36, 422, 3, 240, '2021-04-05 15:31:10'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 36, 454, 8, 241, '2021-04-05 15:31:24'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 36, 473, 11, 242, '2021-04-05 15:31:38'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 36, 451, 7, 243, '2021-04-05 15:31:53'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 36, 480, 12, 244, '2021-04-05 15:32:03'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 36, 477, 11, 245, '2021-04-05 15:32:14'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 37, 480, 12, 246, '2021-04-05 15:32:27'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 37, 480, 12, 246, '2021-04-05 15:32:27'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 37, 465, 9, 247, '2021-04-05 15:32:40'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 37, 459, 8, 248, '2021-04-05 15:32:55'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 37, 459, 8, 248, '2021-04-05 15:32:55'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 37, 434, 5, 249, '2021-04-05 15:33:06'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 37, 400, 0, 250, '2021-04-05 15:33:20'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 37, 400, 0, 251, '2021-04-05 15:33:33'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 37, 403, 0, 252, '2021-04-05 15:33:47'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 37, 400, 0, 253, '2021-04-05 15:34:01'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 37, 400, 0, 253, '2021-04-05 15:34:01'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 36, 419, 2, 254, '2021-04-05 15:34:12'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 36, 419, 2, 254, '2021-04-05 15:34:12'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 37, 419, 2, 255, '2021-04-05 15:34:23'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 37, 441, 6, 257, '2021-04-05 15:34:48'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 36, 437, 5, 258, '2021-04-05 15:35:01'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 36, 409, 1, 259, '2021-04-05 15:35:12'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 36, 402, 0, 260, '2021-04-05 15:35:26'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 36, 402, 0, 260, '2021-04-05 15:35:26'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 23, 45, 400, 0, 3, '2021-04-14 14:34:02'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 23, 44, 400, 0, 4, '2021-04-14 14:34:13'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 23, 44, 400, 0, 4, '2021-04-14 14:34:13'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 23, 44, 400, 0, 5, '2021-04-14 14:34:27'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 23, 44, 408, 1, 6, '2021-04-14 14:34:42'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 23, 44, 406, 0, 7, '2021-04-14 14:34:56'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 23, 44, 406, 0, 7, '2021-04-14 14:34:56'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 23, 45, 413, 1, 8, '2021-04-14 14:35:07'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 45, 415, 2, 9, '2021-04-14 14:35:18'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 45, 415, 2, 9, '2021-04-14 14:35:18'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 23, 44, 406, 0, 10, '2021-04-14 14:35:33'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 44, 403, 0, 11, '2021-04-14 14:35:44'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 44, 403, 0, 13, '2021-04-14 14:36:13'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 44, 403, 0, 13, '2021-04-14 14:36:13'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 44, 413, 1, 14, '2021-04-14 14:36:27'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 44, 413, 1, 14, '2021-04-14 14:36:27'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 44, 415, 2, 15, '2021-04-14 14:36:38'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 44, 415, 2, 15, '2021-04-14 14:36:38'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 44, 416, 2, 16, '2021-04-14 14:36:50'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 44, 419, 2, 17, '2021-04-14 14:37:05'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 44, 427, 4, 18, '2021-04-14 14:37:15'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 45, 445, 6, 19, '2021-04-14 14:37:28'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 44, 427, 4, 20, '2021-04-14 14:37:41'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 44, 419, 2, 21, '2021-04-14 14:37:54'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 44, 414, 2, 22, '2021-04-14 14:38:08'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 44, 414, 2, 23, '2021-04-14 14:38:19'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 44, 411, 1, 24, '2021-04-14 14:38:32'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 44, 414, 2, 25, '2021-04-14 14:38:47'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 44, 421, 3, 26, '2021-04-14 14:38:58'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 44, 421, 3, 26, '2021-04-14 14:38:58'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 44, 437, 5, 27, '2021-04-14 14:39:09'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 45, 444, 6, 28, '2021-04-14 14:39:20'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 44, 434, 5, 29, '2021-04-14 14:39:34'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 44, 419, 2, 30, '2021-04-14 14:39:48'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 44, 419, 2, 30, '2021-04-14 14:39:48'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 44, 444, 6, 31, '2021-04-14 14:40:01'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 44, 444, 6, 32, '2021-04-14 14:40:13'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 44, 444, 6, 32, '2021-04-14 14:40:13'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 44, 425, 3, 33, '2021-04-14 14:40:28'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 44, 419, 2, 34, '2021-04-14 14:40:38'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 44, 423, 3, 35, '2021-04-14 14:40:53'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 44, 417, 2, 36, '2021-04-14 14:41:06'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 44, 423, 3, 37, '2021-04-14 14:41:21'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 44, 477, 11, 39, '2021-04-14 14:41:42'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 44, 477, 11, 39, '2021-04-14 14:41:42'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 45, 490, 13, 40, '2021-04-14 14:41:53'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 44, 439, 5, 41, '2021-04-14 14:42:07'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 44, 433, 5, 42, '2021-04-14 14:42:19'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 44, 428, 4, 43, '2021-04-14 14:42:33'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 44, 428, 4, 45, '2021-04-14 14:42:55'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 44, 426, 3, 47, '2021-04-14 14:43:17'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 44, 428, 4, 48, '2021-04-14 14:43:29'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 44, 426, 3, 49, '2021-04-14 14:43:43'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 44, 441, 6, 50, '2021-04-14 14:43:58'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 44, 441, 6, 50, '2021-04-14 14:43:58'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 44, 441, 6, 52, '2021-04-14 14:44:25'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 44, 437, 5, 56, '2021-04-14 14:45:12'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 44, 437, 5, 57, '2021-04-14 14:45:24'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 44, 442, 6, 59, '2021-04-14 14:45:46'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 44, 520, 18, 60, '2021-04-14 14:46:00'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 44, 442, 6, 63, '2021-04-14 14:46:37'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 44, 441, 6, 64, '2021-04-14 14:46:51'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 44, 437, 5, 65, '2021-04-14 14:47:01'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 44, 441, 6, 66, '2021-04-14 14:47:14'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 44, 442, 6, 68, '2021-04-14 14:47:42'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 44, 442, 6, 69, '2021-04-14 14:47:55'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 44, 444, 6, 70, '2021-04-14 14:48:10'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 44, 444, 6, 70, '2021-04-14 14:48:10'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 44, 444, 6, 71, '2021-04-14 14:48:23'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 44, 451, 7, 72, '2021-04-14 14:48:37'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 44, 451, 7, 72, '2021-04-14 14:48:37'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 44, 444, 6, 73, '2021-04-14 14:48:47'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 44, 446, 7, 75, '2021-04-14 14:49:11'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 44, 450, 7, 76, '2021-04-14 14:49:22'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 44, 450, 7, 76, '2021-04-14 14:49:22'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 44, 452, 7, 77, '2021-04-14 14:49:36'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 44, 452, 7, 77, '2021-04-14 14:49:36'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 44, 446, 7, 79, '2021-04-14 14:50:05'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 43, 459, 8, 80, '2021-04-14 14:50:19'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 44, 457, 8, 83, '2021-04-14 14:50:52'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 43, 454, 8, 84, '2021-04-14 14:51:06'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 43, 455, 8, 85, '2021-04-14 14:51:16'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 43, 455, 8, 85, '2021-04-14 14:51:16'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 43, 451, 7, 86, '2021-04-14 14:51:27'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 44, 455, 8, 87, '2021-04-14 14:51:37'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 43, 455, 8, 88, '2021-04-14 14:51:51'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 43, 455, 8, 88, '2021-04-14 14:51:51'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 43, 453, 8, 90, '2021-04-14 14:52:17'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 43, 465, 9, 93, '2021-04-14 14:52:56'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 43, 456, 8, 94, '2021-04-14 14:53:06'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 43, 456, 8, 94, '2021-04-14 14:53:06'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 43, 454, 8, 95, '2021-04-14 14:53:19'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 43, 456, 8, 96, '2021-04-14 14:53:32'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 43, 456, 8, 96, '2021-04-14 14:53:32'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 43, 456, 8, 97, '2021-04-14 14:53:47'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 43, 452, 7, 98, '2021-04-14 14:53:59'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 43, 455, 8, 99, '2021-04-14 14:54:12'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 43, 459, 8, 101, '2021-04-14 14:54:37'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 43, 459, 8, 101, '2021-04-14 14:54:37'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 43, 459, 8, 102, '2021-04-14 14:54:48'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 43, 459, 8, 102, '2021-04-14 14:54:48'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 43, 457, 8, 103, '2021-04-14 14:55:02'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 43, 464, 9, 104, '2021-04-14 14:55:16'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 43, 272, 52229, 105, '2021-04-14 14:55:31'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 43, 272, 52229, 105, '2021-04-14 14:55:31'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 43, 464, 9, 106, '2021-04-14 14:55:44'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 43, 461, 9, 107, '2021-04-14 14:55:58'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 43, 464, 9, 109, '2021-04-14 14:56:22'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 43, 464, 9, 109, '2021-04-14 14:56:22'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 43, 464, 9, 110, '2021-04-14 14:56:37'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 43, 464, 9, 110, '2021-04-14 14:56:37'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 43, 470, 10, 112, '2021-04-14 14:57:00'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 43, 471, 10, 118, '2021-04-14 14:58:15'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 43, 471, 10, 122, '2021-04-14 14:59:01'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 44, 475, 11, 123, '2021-04-14 14:59:15'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 43, 471, 10, 124, '2021-04-14 14:59:29'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 43, 471, 10, 124, '2021-04-14 14:59:29'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 43, 486, 13, 125, '2021-04-14 14:59:40'),
(CONVERT (0x35202020ff09062d, UNSIGNED), 24, 43, 486, 13, 125, '2021-04-14 14:59:40');

INSERT INTO opzioni (chiave, valore, descrizione)
VALUES ('snapshot_interval', '5', "L'intervallo di tempo espresso in minuti per la creazione di uno snapshot.");

INSERT INTO snapshot (timestamp, titolo, descrizione) VALUES
('2021-05-10 14:22:20', NULL, NULL),
('2021-05-10 16:22:20', NULL, NULL),
('2021-05-10 16:22:30', NULL, NULL),
('2021-05-10 16:22:40', NULL, NULL),
('2021-05-10 16:22:50', NULL, NULL),
('2021-05-10 16:23:00', NULL, NULL),
('2021-05-10 16:23:10', NULL, NULL),
('2021-05-10 16:23:20', NULL, NULL),
('2021-05-10 16:23:30', NULL, NULL),
('2021-05-10 16:23:40', NULL, NULL),
('2021-05-10 16:23:50', NULL, NULL),
('2021-05-10 16:24:00', NULL, NULL),
('2021-05-10 16:24:10', NULL, NULL),
('2021-05-10 16:24:20', NULL, NULL),
('2021-05-10 16:24:30', NULL, NULL),
('2021-05-10 16:24:40', NULL, NULL),
('2021-05-10 16:24:50', NULL, NULL),
('2021-05-10 16:25:00', NULL, NULL),
('2021-05-10 16:25:10', NULL, NULL),
('2021-05-10 16:25:20', NULL, NULL),
('2021-05-10 16:25:30', NULL, NULL),
('2021-05-10 16:25:40', NULL, NULL),
('2021-05-10 16:25:50', NULL, NULL),
('2021-05-10 16:26:00', NULL, NULL),
('2021-05-10 16:26:10', NULL, NULL),
('2021-05-10 16:26:20', NULL, NULL),
('2021-05-10 16:26:30', NULL, NULL),
('2021-05-10 16:26:40', NULL, NULL),
('2021-05-10 16:26:50', NULL, NULL),
('2021-05-10 16:27:00', NULL, NULL),
('2021-05-10 16:27:10', NULL, NULL),
('2021-05-10 16:27:20', NULL, NULL),
('2021-05-10 16:27:30', NULL, NULL),
('2021-05-10 16:27:40', NULL, NULL),
('2021-05-10 16:27:50', NULL, NULL),
('2021-05-10 16:28:00', NULL, NULL),
('2021-05-10 19:04:42', NULL, NULL);

INSERT INTO snapshot_misurazioni (snapshot, misurazione) VALUES
('2021-05-10 16:22:20', 2),
('2021-05-10 16:22:20', 228),
('2021-05-10 16:22:30', 2),
('2021-05-10 16:22:30', 228),
('2021-05-10 16:22:40', 2),
('2021-05-10 16:22:40', 228),
('2021-05-10 16:22:50', 2),
('2021-05-10 16:22:50', 228),
('2021-05-10 16:23:00', 2),
('2021-05-10 16:23:00', 228),
('2021-05-10 16:23:10', 2),
('2021-05-10 16:23:10', 228),
('2021-05-10 16:23:20', 2),
('2021-05-10 16:23:20', 228),
('2021-05-10 16:23:30', 2),
('2021-05-10 16:23:30', 228),
('2021-05-10 16:23:40', 2),
('2021-05-10 16:23:40', 228),
('2021-05-10 16:23:50', 2),
('2021-05-10 16:23:50', 228),
('2021-05-10 16:24:00', 2),
('2021-05-10 16:24:00', 228),
('2021-05-10 16:24:10', 2),
('2021-05-10 16:24:10', 228),
('2021-05-10 16:24:20', 2),
('2021-05-10 16:24:20', 228),
('2021-05-10 16:24:30', 2),
('2021-05-10 16:24:30', 228),
('2021-05-10 16:24:40', 2),
('2021-05-10 16:24:40', 228),
('2021-05-10 16:24:50', 2),
('2021-05-10 16:24:50', 228),
('2021-05-10 16:25:00', 2),
('2021-05-10 16:25:00', 228),
('2021-05-10 16:25:10', 2),
('2021-05-10 16:25:10', 228),
('2021-05-10 16:25:20', 2),
('2021-05-10 16:25:20', 228),
('2021-05-10 16:25:30', 2),
('2021-05-10 16:25:30', 228),
('2021-05-10 16:25:40', 2),
('2021-05-10 16:25:40', 228),
('2021-05-10 16:25:50', 2),
('2021-05-10 16:25:50', 228),
('2021-05-10 16:26:00', 2),
('2021-05-10 16:26:00', 228),
('2021-05-10 16:26:10', 2),
('2021-05-10 16:26:10', 228),
('2021-05-10 16:26:20', 2),
('2021-05-10 16:26:20', 228),
('2021-05-10 16:26:30', 2),
('2021-05-10 16:26:30', 228),
('2021-05-10 16:26:40', 2),
('2021-05-10 16:26:40', 228),
('2021-05-10 16:26:50', 2),
('2021-05-10 16:26:50', 228),
('2021-05-10 16:27:00', 2),
('2021-05-10 16:27:00', 228),
('2021-05-10 16:27:10', 2),
('2021-05-10 16:27:10', 228),
('2021-05-10 16:27:20', 2),
('2021-05-10 16:27:20', 228),
('2021-05-10 16:27:30', 2),
('2021-05-10 16:27:30', 228),
('2021-05-10 16:27:40', 2),
('2021-05-10 16:27:40', 228),
('2021-05-10 16:27:50', 2),
('2021-05-10 16:27:50', 228),
('2021-05-10 16:28:00', 2),
('2021-05-10 16:28:00', 228),
('2021-05-10 19:04:42', 2),
('2021-05-10 19:04:42', 228);